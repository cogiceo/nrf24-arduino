<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>NRF24: NRF24 library for Arduino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NRF24
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> library for Arduino </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the Arduino <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> library. It provides an object-oriented interface for sending and receiving data messages with Nordic nRF24L01 based radio modules, such as the sparkfun WRL-00691 <a href="http://www.sparkfun.com/products/691">http://www.sparkfun.com/products/691</a></p>
<p>The nRF24L01 (<a href="http://www.sparkfun.com/datasheets/Wireless/Nordic/nRF24L01P_Product_Specification_1_0.pdf">http://www.sparkfun.com/datasheets/Wireless/Nordic/nRF24L01P_Product_Specification_1_0.pdf</a>) is a low-cost 2.4GHz ISM transceiver module. It supports a number of channel frequencies in the 2.4GHz band and a range of data rates.</p>
<p>This library provides functions for sending and receiving messages of up to 32 octets on any frequency supported by the nRF24L01, at a selected data rate.</p>
<p>Up to 2 nRF24L01 modules can be connected to an Arduino, permitting the construction of translators and frequency changers, etc.</p>
<p>This library provides classes for</p>
<ul>
<li><a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a>: addressed, reliable, retransmitted, acknowledged messages (using nrf24 Enhanced Shockburst)</li>
</ul>
<p>Example Arduino programs are included to show the main modes of use.</p>
<p>The version of the package that this documentation refers to can be downloaded from <a href="http://www.airspayce.com/mikem/arduino/NRF24/NRF24-1.11.zip">http://www.airspayce.com/mikem/arduino/NRF24/NRF24-1.11.zip</a> You can find the latest version at <a href="http://www.airspayce.com/mikem/arduino/NRF24">http://www.airspayce.com/mikem/arduino/NRF24</a></p>
<p>You can also find online help and disussion at <a href="http://groups.google.com/group/NRF24-arduino">http://groups.google.com/group/NRF24-arduino</a> Please use that group for all questions and discussions on this topic. Do not contact the author directly, unless it is to discuss commercial licensing.</p>
<p>Tested on Arduino Diecimila, Duemilanove and Mega with arduino 1.0 on OpenSuSE 12.1 with avr-libc-1.7.1-1.1, cross-avr-binutils-2.19.1-33.1 and cross-avr-gcc-4.3.3_20100125-28.1, and with arduino-0021 on the same platforms</p>
<dl class="section user"><dt>Packet Format</dt><dd></dd></dl>
<p>All messages sent and received by this <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> library must conform to this packet format, as specified by the nRF24L01 product specificaiton:</p>
<ul>
<li>1 octets PREAMBLE</li>
<li>4 octets ADDRESS</li>
<li>9 bits packet control field</li>
<li>0 to 32 octets PAYLOAD</li>
<li>2 octets CRC</li>
</ul>
<dl class="section user"><dt>Connecting nRF24L01 to Arduino</dt><dd></dd></dl>
<p>The physical connection between the nRF24L01 and the Arduino require 3.3V, the 3 x SPI pins (SCK, SDI, SDO), a Chip Enable pin and a Slave Select pin. If you are using the Sparkfun WRL-00691 module, it has a voltage regulator on board and can be run with 5V VCC The examples below assume the Sparkfun WRL-00691 module</p>
<p>Connect the nRF24L01 to most Arduino's like this (Caution, Arduino Mega has different pins for SPI, see below), </p>
<div class="fragment"><div class="line">         Arduino      Sparkfun WRL-00691</div>
<div class="line">         3V3 or 5V----VCC   (3.3V to 7V in)</div>
<div class="line">     pin D8-----------CE    (chip enable in)</div>
<div class="line">  SS pin D10----------CSN   (chip select in)</div>
<div class="line"> SCK pin D13----------SCK   (SPI clock in)</div>
<div class="line">MOSI pin D11----------SDI   (SPI Data in)</div>
<div class="line">MISO pin D12----------SDO   (SPI data out)</div>
<div class="line">                      IRQ   (Interrupt output, not connected)</div>
<div class="line">         GND----------GND   (ground in)</div>
</div><!-- fragment --><p>For an Arduino Leonardo (the SPI pins do not come out on the Digital pins as for normal Arduino, but only appear on the ICSP header) </p>
<div class="fragment"><div class="line">           Leonardo      Sparkfun WRL-00691</div>
<div class="line">            3V3 or 5V----VCC   (3.3V to 7V in)</div>
<div class="line">        pin D8-----------CE    (chip enable in)</div>
<div class="line">     SS pin D10----------CSN   (chip select in)</div>
<div class="line"> SCK ICSP pin 3----------SCK   (SPI clock in)</div>
<div class="line">MOSI ICSP pin 4----------SDI   (SPI Data in)</div>
<div class="line">MISO ICSP pin 1----------SDO   (SPI data out)</div>
<div class="line">                         IRQ   (Interrupt output, not connected)</div>
<div class="line">            GND----------GND   (ground in)</div>
</div><!-- fragment --><p> and initialise the <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> object like this to explicitly set the SS pin <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> nrf24(8, 10);</p>
<p>For an Arduino Mega: </p>
<div class="fragment"><div class="line">         Mega         Sparkfun WRL-00691</div>
<div class="line">         3V3 or 5V----VCC   (3.3V to 7V in)</div>
<div class="line">     pin D8-----------CE    (chip enable in)</div>
<div class="line">  SS pin D53----------CSN   (chip select in)</div>
<div class="line"> SCK pin D52----------SCK   (SPI clock in)</div>
<div class="line">MOSI pin D51----------SDI   (SPI Data in)</div>
<div class="line">MISO pin D50----------SDO   (SPI data out)</div>
<div class="line">                      IRQ   (Interrupt output, not connected)</div>
<div class="line">         GND----------GND   (ground in)</div>
</div><!-- fragment --><p> and you can then use the default constructor NRF24(). You can override the default settings for the CSN and CE pins in the NRF24() constructor if you wish to connect the slave select CSN to other than the normal one for your Arduino (D10 for Diecimila, Uno etc and D53 for Mega)</p>
<p>Caution: on some Arduinos such as the Mega 2560, if you set the slave select pin to be other than the usual SS pin (D53 on Mega 2560), you may need to set the usual SS pin to be an output to force the Arduino into SPI master mode.</p>
<p>Caution: this module has not been proved to work with Leonardo, at least without level shifters between the <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> and the Leonardo. Tests seem to indicate that such level shifters would be required with Leonardo to make it work.</p>
<p>It is possible to have 2 radios conected to one arduino, provided each radio has its own CSN and CE line (SCK, SDI and SDO are common to both radios)</p>
<dl class="section user"><dt>Example programs</dt><dd></dd></dl>
<p>The following example programs are provided: -nrf24_ping_client, nrf24_pin_server. This is a matched pair. The client sends (acknowledged) 4 byte timestamp to the server which replies (acknowledged). The client measures the round-trip time and prints it. Typical RTT is 1-2 msec. These are compatible radio wise with the ping_client and ping_server programs that come with the Mirf library though the electrical connections are different -nrf24_specan. Example sketch showing how to create a primitive spectrum analyser with the <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> class. The nRF24L01 received power detector is only one bit, but this will show which channels have more than -64dBm present. -nrf24_audio_tx, nrf24_audio_rx. This is a matched pair. The clinet sends a stream of audio samples measured from analog input 0 to the receiver, which reconstructs them on output D6. See comments in those files for electrical requirements. The pair demonstrates the use of <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> in NOACK modefor improved performance (but no reliability). Can achieve 6.4kHz sample rate. Dont expect good quality audio!</p>
<dl class="section user"><dt>Radio Performance</dt><dd></dd></dl>
<p>The performance of this radio seems to be very good. I was able to build ping client/server that was able to achieve over 800 round trips per second (at 0dBm power, 2Mbps, channel 1, 4 byte payload each way, 1 checksum byte) when the radios were next to each other. This rate could still be achieved at 15m distance, but the orientation of the radios and obstructions became critical. The human body can easily block these signals. Best response was when the chip antennas were broadside to each other.</p>
<p>It is possible to get even better streaming performance using NOACK mode (see the nrf24_audio_tx sample) at the cost of nop reliability. In NOACK mode, at 2Mbps, 32 byte payload, can get about 1900 packets per second: 60800 bytes of payload per second</p>
<p>Frequency accuracy may be debatable. For nominal frequency of 2401.000 MHz (ie channel 1), my Yaesu VR-5000 receiver indicated the center frequency for my test radios was 2401.121 MHz. Its not clear to me if the Yaesu is the source of the error, but I tend to believe it, which would make the nRF24l01 frequency out by 121kHz.</p>
<dl class="section user"><dt>Radio operating strategy and defaults</dt><dd></dd></dl>
<p>The radio is enabled all the time, and switched between TX and RX modes depending on whether there is any data to send. Sending data sets the radio to TX mode. After data is sent, the radion automatically returns to Standby II mode. Calling waitAvailable() or waitAvailableTimeout() starts the radio in RX mode.</p>
<p>The radio is configured by default to Channel 2, 2Mbps, 0dBm power, 5 bytes address, payload width 1, CRC enabled 1 byte CRC, Auto-Ack mode. Enhanced shockburst is used. P1 is the receive pipe. P0 is set to the transmit address to enable autoack.</p>
<dl class="section user"><dt>Memory</dt><dd></dd></dl>
<p>Memory usage of this program is minimal. The compiled ping client and server programs are about 4000 bytes. RAM requirements of the library are minimal.</p>
<dl class="section user"><dt>Installation</dt><dd></dd></dl>
<p>Install in the usual way: unzip the distribution zip file to the libraries sub-folder of your sketchbook.</p>
<p>This software is Copyright (C) 2012 Mike McCauley. Use is subject to license conditions. The main licensing options available are GPL V2 or Commercial:</p>
<dl class="section user"><dt>Open Source Licensing GPL V2</dt><dd></dd></dl>
<p>This is the appropriate option if you want to share the source code of your application with everyone you distribute it to, and you also want to give them the right to share who uses it. If you wish to use this software under Open Source Licensing, you must contribute all your source code to the open source community in accordance with the GPL Version 2 when your application is distributed. See <a href="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</a></p>
<dl class="section user"><dt>Commercial Licensing</dt><dd></dd></dl>
<p>This is the appropriate option if you are creating proprietary applications and you are not prepared to distribute and share the source code of your application. Contact <a href="#" onclick="location.href='mai'+'lto:'+'inf'+'o@'+'air'+'sp'+'ayc'+'e.'+'com'; return false;">info@<span style="display: none;">.nosp@m.</span>airs<span style="display: none;">.nosp@m.</span>payce<span style="display: none;">.nosp@m.</span>.com</a> for details.</p>
<dl class="section user"><dt>Revision History</dt><dd></dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 Initial release</dd>
<dd>
1.1 Changed default value for slave slect pin in constructor to be SS, ie the normal one for the compiled Arduino (D10 for Diecimila, Uno etc and D53 for Mega). This is because some Arduinos such as Mega 2560 reportedly use the type of the SS pin to determine whether to run in slave or master mode. Therfore it is preferred that the slave select pin actually be the normal SS pin.</dd>
<dd>
1.2 Updated documentation about what happens during init, and that SPI is initialised to 8MHz (but can be set to other frequencies after calling init() </dd>
<dd>
1.3 Fixed error in title of main page </dd>
<dd>
1.4 Fixed typo in nrf24_test.pde, reported by TOM. </dd>
<dd>
1.6 Fixed an error <a class="el" href="classNRF24.html#a3453db8390d5be4aa99d8c7fde3062a4">NRF24::setRF</a> in setting data rate to 250kbps. Reported by Shiu Kumar. </dd>
<dd>
1.7 Improvements to waitPacketSent() so if the chip is not in transmit mode, it wont wait forever. Improvements to isSending() so it returns false if the chip is not in transmit mode. </dd>
<dd>
1.8 Fixed a conflict between 2 definitions of NRF24_TX_FULL. The one in 07 STATUS is changed to NRF24_STATUS_TX_FULL. Reported by Charles-Henri Hallard. Updated author and distribution location details to airspayce.com </dd>
<dd>
1.9 Improvements to waitAvailableTimeout to make it robust on millis() rollover. </dd>
<dd>
1.10 Testing with Leonardo and update documentation to reflect special electrical connection needs on Leonardo. </dd>
<dd>
1.11 NRF24_COMMAND_W_ACK_PAYLOAD(c) is now a macro that takes a pipe number parameter. Added new function setRetry(), a convenience for setting ARD and ARC retry parameter. Can now customise the radio configuration byte with setConfiguration(). Added new examples crazyflie and crazyflie_client that use the <a class="el" href="classNRF24.html" title="Send and receive addressed, reliable, acknowledged datagrams by nRF24L01.">NRF24</a> library to communicate with Crazyflie quadcopters and transmitters.</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Mike McCauley (<a href="#" onclick="location.href='mai'+'lto:'+'mik'+'em'+'@ai'+'rs'+'pay'+'ce'+'.co'+'m'; return false;">mikem<span style="display: none;">.nosp@m.</span>@air<span style="display: none;">.nosp@m.</span>spayc<span style="display: none;">.nosp@m.</span>e.co<span style="display: none;">.nosp@m.</span>m</a>) DO NOT CONTACT THE AUTHOR DIRECTLY: USE THE LISTS </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
